# âœ… ç¬¬ä¸€é˜¶æ®µå®Œæˆï¼šåŸºç¡€è®¾æ–½ä¸æ•°æ®æ¨¡å‹ï¼ˆå®ä½“å±‚ï¼‰

## ğŸ“Š è¿ç§»å®Œæˆæƒ…å†µ

### 1ï¸âƒ£ å·²åˆ›å»ºçš„å®ä½“æ–‡ä»¶

| Java å®ä½“ | TypeORM å®ä½“ | çŠ¶æ€ | è¯´æ˜ |
|-----------|-------------|------|------|
| `BaseEntity.java` | `base.entity.ts` | âœ… å®Œæˆ | åŸºç±»å®ä½“ï¼ŒåŒ…å«é€šç”¨å­—æ®µ |
| `SysUser.java` | `sys-user.entity.ts` | âœ… å®Œæˆ | ç”¨æˆ·å®ä½“ï¼Œæ ¸å¿ƒè¡¨ |
| `SysDept.java` | `sys-dept.entity.ts` | âœ… å®Œæˆ | éƒ¨é—¨å®ä½“ï¼Œæ ‘å½¢ç»“æ„ |
| `SysRole.java` | `sys-role.entity.ts` | âœ… å®Œæˆ | è§’è‰²å®ä½“ |
| `SysMenu.java` | `sys-menu.entity.ts` | âœ… å®Œæˆ | èœå•å®ä½“ï¼Œæ ‘å½¢ç»“æ„ |
| `SysPost.java` | `sys-post.entity.ts` | âœ… å®Œæˆ | å²—ä½å®ä½“ |

### 2ï¸âƒ£ å®ä½“å…³ç³»æ˜ å°„

#### âœ… ä¸€å¯¹å¤šå…³ç³»ï¼ˆOneToMany / ManyToOneï¼‰
- **SysUser â†’ SysDept**ï¼šç”¨æˆ·å±äºä¸€ä¸ªéƒ¨é—¨
  ```typescript
  @ManyToOne(() => SysDept, { nullable: true })
  @JoinColumn({ name: 'dept_id' })
  dept?: SysDept;
  ```

#### âœ… å¤šå¯¹å¤šå…³ç³»ï¼ˆManyToManyï¼‰
- **SysUser â†” SysRole**ï¼šç”¨æˆ·å’Œè§’è‰²ï¼ˆé€šè¿‡ `sys_user_role` ä¸­é—´è¡¨ï¼‰
  ```typescript
  @ManyToMany(() => SysRole)
  @JoinTable({
    name: 'sys_user_role',
    joinColumn: { name: 'user_id', referencedColumnName: 'userId' },
    inverseJoinColumn: { name: 'role_id', referencedColumnName: 'roleId' },
  })
  roles?: SysRole[];
  ```

- **SysUser â†” SysPost**ï¼šç”¨æˆ·å’Œå²—ä½ï¼ˆé€šè¿‡ `sys_user_post` ä¸­é—´è¡¨ï¼‰
  ```typescript
  @ManyToMany(() => SysPost)
  @JoinTable({
    name: 'sys_user_post',
    joinColumn: { name: 'user_id', referencedColumnName: 'userId' },
    inverseJoinColumn: { name: 'post_id', referencedColumnName: 'postId' },
  })
  posts?: SysPost[];
  ```

- **SysRole â†” SysMenu**ï¼šè§’è‰²å’Œèœå•ï¼ˆé€šè¿‡ `sys_role_menu` ä¸­é—´è¡¨ï¼‰
  ```typescript
  @ManyToMany(() => SysMenu)
  @JoinTable({
    name: 'sys_role_menu',
    joinColumn: { name: 'role_id', referencedColumnName: 'roleId' },
    inverseJoinColumn: { name: 'menu_id', referencedColumnName: 'menuId' },
  })
  menus?: SysMenu[];
  ```

- **SysRole â†” SysDept**ï¼šè§’è‰²å’Œéƒ¨é—¨ï¼ˆé€šè¿‡ `sys_role_dept` ä¸­é—´è¡¨ï¼‰
  ```typescript
  @ManyToMany(() => SysDept)
  @JoinTable({
    name: 'sys_role_dept',
    joinColumn: { name: 'role_id', referencedColumnName: 'roleId' },
    inverseJoinColumn: { name: 'dept_id', referencedColumnName: 'deptId' },
  })
  depts?: SysDept[];
  ```

#### âœ… æ ‘å½¢ç»“æ„ï¼ˆTreeï¼‰
- **SysDept**ï¼šéƒ¨é—¨æ ‘å½¢ç»“æ„
  ```typescript
  @Tree('materialized-path')
  export class SysDept extends BaseEntity {
    @TreeParent()
    parent?: SysDept;
    
    @TreeChildren()
    children?: SysDept[];
  }
  ```

- **SysMenu**ï¼šèœå•æ ‘å½¢ç»“æ„
  ```typescript
  @Tree('materialized-path')
  export class SysMenu extends BaseEntity {
    @TreeParent()
    parent?: SysMenu;
    
    @TreeChildren()
    children?: SysMenu[];
  }
  ```

### 3ï¸âƒ£ å­—æ®µå‘½åæ˜ å°„

âœ… **Java é©¼å³°å‘½å â†’ æ•°æ®åº“ä¸‹åˆ’çº¿å‘½å**

| Java å­—æ®µ | TypeScript å­—æ®µ | æ•°æ®åº“å­—æ®µ | æ˜ å°„æ–¹å¼ |
|-----------|----------------|-----------|---------|
| `userId` | `userId` | `user_id` | `@Column({ name: 'user_id' })` |
| `userName` | `userName` | `user_name` | `@Column({ name: 'user_name' })` |
| `nickName` | `nickName` | `nick_name` | `@Column({ name: 'nick_name' })` |
| `createBy` | `createBy` | `create_by` | `@Column({ name: 'create_by' })` |
| `createTime` | `createTime` | `create_time` | `@CreateDateColumn({ name: 'create_time' })` |
| `updateBy` | `updateBy` | `update_by` | `@Column({ name: 'update_by' })` |
| `updateTime` | `updateTime` | `update_time` | `@UpdateDateColumn({ name: 'update_time' })` |

### 4ï¸âƒ£ ç‰¹æ®Šå¤„ç†

#### âœ… å¯†ç å­—æ®µå®‰å…¨
```typescript
@Exclude() // åºåˆ—åŒ–æ—¶è‡ªåŠ¨æ’é™¤å¯†ç å­—æ®µ
@Column({ type: 'varchar', length: 100, default: '', comment: 'å¯†ç ' })
password: string;
```

#### âœ… ç®¡ç†å‘˜åˆ¤æ–­æ–¹æ³•
```typescript
// SysUser
isAdmin(): boolean {
  return this.userId === 1;
}

// SysRole
isAdmin(): boolean {
  return this.roleId === 1;
}
```

#### âœ… Swagger API æ–‡æ¡£æ³¨è§£
```typescript
@ApiProperty({ description: 'ç”¨æˆ·ID' })
@ApiPropertyOptional({ description: 'ç”¨æˆ·é‚®ç®±' })
```

## ğŸ“¦ å·²æ›´æ–°çš„é…ç½®

### 1ï¸âƒ£ package.json
- âœ… ç§»é™¤ Prisma ä¾èµ–
- âœ… æ·»åŠ  TypeORM ä¾èµ–
  - `@nestjs/typeorm: ^10.0.1`
  - `typeorm: ^0.3.19`
  - `mysql2: ^3.7.0`
- âœ… æ›´æ–°è„šæœ¬å‘½ä»¤

### 2ï¸âƒ£ ç¯å¢ƒå˜é‡ (.env)
```env
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=root123
DB_DATABASE=ry-vue
```

### 3ï¸âƒ£ TypeORM é…ç½® (typeorm.config.ts)
- âœ… æ•°æ®åº“è¿æ¥é…ç½®
- âœ… å®ä½“è‡ªåŠ¨åŠ è½½
- âœ… æ—¶åŒºè®¾ç½®ï¼ˆ+08:00ï¼‰
- âœ… å­—ç¬¦é›†è®¾ç½®ï¼ˆutf8mb4ï¼‰

### 4ï¸âƒ£ App Module
- âœ… ç§»é™¤ PrismaModule
- âœ… æ·»åŠ  TypeOrmModule
- âœ… ä½¿ç”¨ typeOrmConfig é…ç½®

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ typeorm.config.ts          # TypeORM é…ç½®
â”œâ”€â”€ domain/
â”‚   â””â”€â”€ entities/
â”‚       â”œâ”€â”€ base.entity.ts         # åŸºç±»å®ä½“
â”‚       â”œâ”€â”€ sys-user.entity.ts     # ç”¨æˆ·å®ä½“
â”‚       â”œâ”€â”€ sys-dept.entity.ts     # éƒ¨é—¨å®ä½“
â”‚       â”œâ”€â”€ sys-role.entity.ts     # è§’è‰²å®ä½“
â”‚       â”œâ”€â”€ sys-menu.entity.ts     # èœå•å®ä½“
â”‚       â”œâ”€â”€ sys-post.entity.ts     # å²—ä½å®ä½“
â”‚       â””â”€â”€ index.ts               # ç»Ÿä¸€å¯¼å‡º
â””â”€â”€ app.module.ts                  # æ ¹æ¨¡å—ï¼ˆå·²æ›´æ–°ï¼‰
```

## ğŸ¯ ä¸‹ä¸€æ­¥å·¥ä½œ

### ç¬¬äºŒé˜¶æ®µï¼šMapper å±‚ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰

éœ€è¦è¿ç§»çš„æ–‡ä»¶ï¼š
1. `SysUserMapper.java` + `SysUserMapper.xml`
2. `SysUserRoleMapper.java` + `SysUserRoleMapper.xml`
3. `SysUserPostMapper.java` + `SysUserPostMapper.xml`

åˆ›å»ºå¯¹åº”çš„ TypeORM Repositoryï¼š
- `user.repository.ts`
- `user-role.repository.ts`
- `user-post.repository.ts`

### ç¬¬ä¸‰é˜¶æ®µï¼šService å±‚ï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰

éœ€è¦è¿ç§»çš„æ–‡ä»¶ï¼š
1. `ISysUserService.java`
2. `SysUserServiceImpl.java`

åˆ›å»ºå¯¹åº”çš„ NestJS Serviceï¼š
- `user.service.ts`

### ç¬¬å››é˜¶æ®µï¼šController å±‚ï¼ˆæ¥å£å±‚ï¼‰

éœ€è¦è¿ç§»çš„æ–‡ä»¶ï¼š
1. `SysUserController.java`

åˆ›å»ºå¯¹åº”çš„ NestJS Controllerï¼š
- `user.controller.ts`

## ğŸš€ å¦‚ä½•å¯åŠ¨

### 1. å®‰è£…ä¾èµ–
```bash
cd "/Users/mac/Desktop/project/ruoyi 2/nestRuoyi"
npm install
```

### 2. é…ç½®æ•°æ®åº“
ç¡®ä¿ `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®æ­£ç¡®

### 3. å¯åŠ¨åº”ç”¨
```bash
npm run start:dev
```

### 4. éªŒè¯
- åº”ç”¨åœ°å€ï¼šhttp://localhost:3000
- Swagger æ–‡æ¡£ï¼šhttp://localhost:3000/api-docs

## âœ… æ ¸å¿ƒç‰¹æ€§

1. **å®Œæ•´çš„å®ä½“å…³ç³»æ˜ å°„**
   - ä¸€å¯¹å¤šå…³ç³»ï¼ˆUser â†’ Deptï¼‰
   - å¤šå¯¹å¤šå…³ç³»ï¼ˆUser â†” Role, User â†” Post, Role â†” Menu, Role â†” Deptï¼‰
   - æ ‘å½¢ç»“æ„ï¼ˆDept, Menuï¼‰

2. **å­—æ®µå‘½åè‡ªåŠ¨æ˜ å°„**
   - TypeScript é©¼å³°å‘½å
   - æ•°æ®åº“ä¸‹åˆ’çº¿å‘½å
   - è‡ªåŠ¨è½¬æ¢

3. **ç±»å‹å®‰å…¨**
   - ä¸¥æ ¼çš„ TypeScript ç±»å‹å®šä¹‰
   - Swagger API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
   - class-validator æ•°æ®éªŒè¯

4. **å®‰å…¨æ€§**
   - å¯†ç å­—æ®µåºåˆ—åŒ–æ—¶è‡ªåŠ¨æ’é™¤
   - è½¯åˆ é™¤æ”¯æŒï¼ˆdelFlagï¼‰
   - ç®¡ç†å‘˜æƒé™åˆ¤æ–­

---

**ç¬¬ä¸€é˜¶æ®µå®Œæˆï¼å‡†å¤‡å¥½è¿›å…¥ç¬¬äºŒé˜¶æ®µäº†å—ï¼Ÿ** ğŸŠ

