# è·¯ç”±ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

åœ¨ NestJS 11 ä¸­ï¼Œä½¿ç”¨æ–°ç‰ˆ `path-to-regexp` åº“ï¼Œä¸å†æ”¯æŒå¯é€‰å‚æ•°è¯­æ³• `:userId?`ã€‚

### é”™è¯¯ä¿¡æ¯

```
PathError [TypeError]: Unexpected ? at index 20, expected end: /system/user/:userId?
```

## è§£å†³æ–¹æ¡ˆ

å°†åŸæ¥çš„å¯é€‰å‚æ•°è·¯ç”±æ‹†åˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„è·¯ç”±ï¼š

### ä¿®æ”¹å‰

```typescript
@Get(':userId?')
async getInfo(@Param('userId') userId?: number): Promise<ResponseDto> {
  if (userId) {
    // è·å–ç”¨æˆ·è¯¦æƒ…
  } else {
    // è·å–åˆå§‹åŒ–ä¿¡æ¯
  }
}
```

### ä¿®æ”¹å

```typescript
// è·¯ç”±1ï¼šè·å–åˆå§‹åŒ–ä¿¡æ¯ï¼ˆæ— å‚æ•°ï¼‰
@Get()
async getInitInfo(): Promise<ResponseDto> {
  // è·å–æ‰€æœ‰è§’è‰²å’Œå²—ä½
  return ResponseDto.success(data);
}

// è·¯ç”±2ï¼šè·å–ç”¨æˆ·è¯¦æƒ…ï¼ˆæœ‰å‚æ•°ï¼‰
@Get(':userId')
async getInfo(@Param('userId', ParseIntPipe) userId: number): Promise<ResponseDto> {
  // è·å–æŒ‡å®šç”¨æˆ·è¯¦æƒ…
  return ResponseDto.success(data);
}
```

## è·¯ç”±é¡ºåºè¯´æ˜

**é‡è¦**ï¼šåœ¨ NestJS ä¸­ï¼Œè·¯ç”±çš„é¡ºåºå¾ˆé‡è¦ï¼

- æ›´å…·ä½“çš„è·¯ç”±åº”è¯¥æ”¾åœ¨å‰é¢
- é€šé…ç¬¦è·¯ç”±åº”è¯¥æ”¾åœ¨åé¢

### æ­£ç¡®é¡ºåº

```typescript
@Get('list')           // 1. æœ€å…·ä½“çš„è·¯ç”±
@Get('deptTree')       // 2. å…·ä½“çš„è·¯ç”±
@Get('resetPwd')       // 3. å…·ä½“çš„è·¯ç”±
@Get()                 // 4. æ— å‚æ•°è·¯ç”±
@Get(':userId')        // 5. å‚æ•°è·¯ç”±ï¼ˆæœ€åï¼‰
```

### é”™è¯¯é¡ºåº

```typescript
@Get(':userId')        // âŒ å‚æ•°è·¯ç”±åœ¨å‰ï¼Œä¼šåŒ¹é…æ‰€æœ‰è¯·æ±‚
@Get('list')           // âŒ æ°¸è¿œä¸ä¼šè¢«åŒ¹é…åˆ°
```

## æœ€ç»ˆè·¯ç”±åˆ—è¡¨

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/system/user/list` | è·å–ç”¨æˆ·åˆ—è¡¨ |
| GET | `/system/user/deptTree` | è·å–éƒ¨é—¨æ ‘ |
| GET | `/system/user/authRole/:userId` | è·å–æˆæƒè§’è‰² |
| GET | `/system/user` | è·å–åˆå§‹åŒ–ä¿¡æ¯ |
| GET | `/system/user/:userId` | è·å–ç”¨æˆ·è¯¦æƒ… |
| POST | `/system/user` | æ–°å¢ç”¨æˆ· |
| PUT | `/system/user` | ä¿®æ”¹ç”¨æˆ· |
| PUT | `/system/user/resetPwd` | é‡ç½®å¯†ç  |
| PUT | `/system/user/changeStatus` | ä¿®æ”¹çŠ¶æ€ |
| PUT | `/system/user/authRole` | ç”¨æˆ·æˆæƒè§’è‰² |
| DELETE | `/system/user/:userIds` | åˆ é™¤ç”¨æˆ· |

## éªŒè¯ç»“æœ

âœ… æœåŠ¡å¯åŠ¨æˆåŠŸ
âœ… æ‰€æœ‰è·¯ç”±æ­£ç¡®æ˜ å°„
âœ… Swagger æ–‡æ¡£å¯è®¿é—®

```
ğŸš€ Application is running on: http://localhost:3000
ğŸ“š Swagger documentation: http://localhost:3000/api-docs
```

